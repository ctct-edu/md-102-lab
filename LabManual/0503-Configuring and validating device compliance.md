# ラボ 0503: デバイス コンプライアンスの構成と検証



## 概要



このラボでは、マネージド デバイスの状態を判断するために使用されるコンプライアンス ポリシーと関連する条件付きアクセス規則を構成して、デバイスのコンプライアンスを検証します。

### 前提 条件



このラボの前に、次のラボを完了する必要があります。

- 0101 - Entra IDでのアイデンティティの管理

- 0102 - Entra Connect を使用した ID の同期

- 0203-Intuneへのデバイス登録の管理

- 0204-Intune へのデバイスの登録

- 0301-構成プロファイルの作成と配備

  > 注: Entra ID への Windows Hello サインイン認証をセキュリティで保護するために使用されるテキスト メッセージを受信できる携帯電話も必要です。

## 演習 1: コンプライアンス・ポリシーの構成



### シナリオ



Contoso は、Intune に登録されている Windows デバイスが最小構成仕様を満たしていることを確認したいと考えています。必要な仕様は次のとおりです。

- Windows オペレーティング システムの最小バージョン: 10.0.19041.329
- Microsoft Defender マルウェア対策が必要

デバイスがこれらの要件を満たしている場合、準拠としてマークされます。デバイスがこれらの要件を満たしていない場合は、デバイスを非準拠としてマークする必要があります。

### タスク1: コンプライアンス・ポリシーの作成および割当て



1. パスワード **Pa55w.rd** を使用して **Contoso\Administrator** として **SEA-SVR1** にサインインし、**サーバー マネージャー**を閉じます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. Microsoft Edge で、アドレス バーに「**[https://intune.microsoft.com](https://intune.microsoft.com/)**」と入力し、**Enter キー**を押します。

4. 既定のテナント パスワードを使用して、**`admin@yourtenant.onmicrosoft.com`** としてサインインします。

5. ナビゲーション ウィンドウから **[デバイス]** を選択し、 **[コンプライアンス]** を選択します。

6. **デバイス上 |[コンプライアンス]** ブレードの詳細ウィンドウで、 **[+ ポリシーの作成**] を選択します。

7. [**ポリシーの作成**] ブレードで、次の値を指定し、 **[作成]** を選択します。

   - プラットフォーム: **Windows 10 以降**
   - プロファイルの種類: **Windows 10/11 コンプライアンス ポリシー**

8. [**基本]** タブで、次の値を指定し、[**次へ**] を選択します。

   - 名前: **コンプライアンス1**

9. [**コンプライアンス設定]** タブで、[**デバイスの正常性**] を展開し、使用可能な設定を確認します。

10. [**コンプライアンス設定]** タブで、[**デバイスのプロパティ]** を展開します。[**最小 OS バージョン]** フィールドに「**10.0.19041.329**」と入力します。

11. [**コンプライアンス設定]** タブで、[**システム セキュリティ]** を展開します。**[Microsoft Defender マルウェア対策**] 設定を **[必須]** に設定します。

12. [**次へ**] を選択します。[ **非準拠のアクション** ] タブで、[ **デバイス非準拠の既定値にマークする ]** のアクションが **[即時**] であることに注意してください。

    > デバイスが非準拠としてマークされるまでの日数を設定する方法と、追加のアクションを設定する方法を確認します。

13. [**次へ**] を選択します。[**割り当て]** タブの **[含まれるグループ]** で **[グループの追加**] を選択します。**[Windows デバイス]** を選択し、[**選択]** を選択して、[**次へ**] を選択します。

    *注: **Windows デバイス** グループは、ラボ 0301: 構成プロファイルの作成と展開で作成されました。*

14. [**確認 + 作成**] タブで、設定を確認し、[**作成]** を選択します。

15. ナビゲーション メニューで **[デバイス]** を選択し、[デバイス] ナビゲーション ウィンドウで **[コンプライアンス]** を選択します。

16. **デバイス上 |[コンプライアンス]** ブレードで、[**コンプライアンス設定]** タブを選択します。

17. [**コンプライアンス設定]** ページで、[**コンプライアンス状態の有効期間**] に **30** が表示されていることを確認します。指定されていない場合は、その値を入力します。

18. [**コンプライアンス設定]** ページで、[**コンプライアンス ポリシーが割り当てられていないデバイスをマークする] を**切り替えて、[**非準拠**] と表示され、[**保存]** を選択します。

    > この設定により、コンプライアンス ポリシーが割り当てられていないデバイスはすべて [**非準拠]** に設定されます。

**結果**: この演習を完了すると、コンプライアンス ポリシーが正常に構成されます。

## 演習 2: コンプライアンスを適用するための条件付きアクセス ポリシーを作成する



### シナリオ



ユーザーが非準拠としてマークされたデバイスを使用すると、電子メールにアクセスできなくなります。このルールを適用する条件付きアクセス ポリシーを構成し、期待どおりに機能することを確認するように求められました。場合によっては、サインインを繰り返し求められるループが発生することがあります。

### タスク 1: 条件付きアクセス ポリシーを作成する



1. **SEA-SVR1** では、**Intune 管理センター**で **[デバイス]** を選択し、 **[条件付きアクセス]** を選択します。
2. **条件付きアクセス |[概要]** ブレードで、 **[ポリシー]** を選択します。
3. **条件付きアクセス |[ポリシー]** ブレードで、 [**新しいポリシー**] を選択します。
4. [**新規]** ブレードの [**名前**] テキスト ボックスに「**Conditional1」**と入力し、選択した **0 のユーザーとグループ**を選択します。
5. **[含める]** で、[**すべてのユーザー**] ラジオ ボタンを選択します。
6. [**ターゲット リソース]** セクションで、[**ターゲット リソースが選択されていません**] を選択します。
7. **[含める]** で [**リソースの選択**] ラジオ ボタンを選択し、[選択] 見出しで [**なし**] を選択し、[**Office 365 Exchange Online**] を選択して、[**選択]** をクリックします。
8. [**条件]** セクションで、**選択した条件を 0** 個選択します。
9. 条件のリストで、[**デバイス プラットフォーム**] で [**未構成]** を選択します。[**構成]** セクションで [**はい**] を選択し、[**デバイス プラットフォームの選択**] ラジオ ボタンを選択し、[**Windows**] チェック ボックスをオンにして、[**完了]** を選択します。
10. [**付与]** セクションで、**選択した 0 個のコントロール**を選択します。[**デバイスに準拠としてマークする必要がある]** チェック ボックスをオンにし、[**選択]** を選択します。
11. [**新規]** ブレードで、[**ポリシーを有効にする]** オプションで **[オン**] を選択し、 **[作成]** を選択します。
12. Microsoft Edge を閉じます。

### タスク 2: 条件付きアクセス ポリシーが機能していることを確認する



1. **SEA-WS3** に切り替え、**Pa55w.rd** のパスワードで**管理者**としてサインインします。

2. **SEA-WS3** のタスク バーで、[**Microsoft Edge]** を選択します。

3. Microsoft Edge で、「**outlook.office.com**」と入力し、Enter キーを押します。

4. 勘定の選択 ダイアログ ボックスで、**`Aaron@yourtenant.onmicrosoft.com`** を選択します。

5. [**パスワードの入力**] ページで、「**Pa55w.rd1234!」**と入力し、[**サインイン]** を選択します。

   > **手記**Microsoft Edge の [パスワードの保存] プロンプトが表示されたら、[**更新]** を選択します。

6. Edge プロファイルを切り替えるように求めるメッセージが表示されます。**[エッジ プロファイルの切り替え(Switch Edge profile)]** を選択します。

7. 「**職場または学校のアカウントで続行**してください」というメッセージが表示されます。**[サインイン] を選択してデータを同期**します。

8. パスワードの入力を再度必要とします。**「Pa55w.rd1234!」**と入力し、[**サインイン]** を選択します。

9. 「**このデバイス上のすべてのデスクトップ アプリと Web サイトに自動的にサインインしますか?**」というダイアログ ボックスが表示されます。[**いいえ、このアプリにのみサインインします]** を選択します。

   > 注: 「**組織リソースにアクセスするようにプロファイルを設定しましょう**」というダイアログが表示されます。これは、SEA-WS3 が Entra ID に参加しておらず、Intune によって管理されていないためです。そのため、このデバイスからアーロンズのメールボックスにアクセスすることはできません。

10. すべてのウィンドウ**を閉じ**て、**SEA-WS3** からサインアウトします。

11. **SEA-WS1** に切り替え、PIN **102938**を使用して Aaron Nicholls としてサインインします。

    > 注: SEA-WS1 は、Intune に登録されているマネージド Windows 11 デバイスです。

12. タスク バーで、[**Microsoft Edge]** を選択します。

13. Microsoft Edge で、「**outlook.office.com**」と入力し、Enter キーを押します。

14. Aaron のメールボックスにアクセスできることを確認します。

    > 注:これは、SEA-WS1が管理対象デバイスであり、準拠としてマークされているためです。

15. Microsoft Edge を閉じて、SEA-WS1 からサインアウトします。

### タスク 3: 条件付きアクセス ポリシーを無効にする



1. **SEA-SVR1** に切り替えて、パスワード **Pa55w.rd** を入力します。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. Microsoft Edge で、アドレス バーに「**[https://intune.microsoft.com](https://intune.microsoft.com/)**」と入力し、 **Enter キー**を押します。

4. 既定のテナント パスワードを使用して、**`admin@yourtenant.onmicrosoft.com`** としてサインインします。

5. ナビゲーション ウィンドウから **[デバイス]** を選択し、[**すべてのデバイス**] を選択します。

   > SEA-WS1 は準拠しているため、Aaron は自分のメールボックスへのアクセスを許可されました。

6. ナビゲーション ウィンドウから **[デバイス]** を選択し、 **[条件付きアクセス]** を選択します。

7. [**条件付きアクセス]** ページで、[**ポリシー]** を選択し、 **[条件付き 1]** を選択します。

8. [**条件 1]** ページの下部にある **[オフ]** を選択し、 [**保存**] を選択します。

9. Microsoft Edge を閉じます。

**結果**: この演習を完了すると、デバイスのコンプライアンスを判断するための条件付きアクセス ポリシーが正常に構成されます。

**ラボの終わり**
