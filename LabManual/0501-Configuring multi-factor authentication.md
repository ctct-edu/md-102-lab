# ラボ 0501: 多要素認証の構成



## 概要



このラボでは、ユーザーごとの多要素認証 (MFA) を構成し、条件付きアクセス ポリシーを使用して MFA を適用します。

### 前提 条件



Entra ID への Windows Hello サインイン認証をセキュリティで保護するために使用されるテキスト メッセージを受信できる携帯電話が必要です。

## 演習 1: ユーザーごとの多要素認証を構成する



### シナリオ



ユーザー サインオン イベントのセキュリティを強化するには、多要素認証 (MFA) を構成してテストする必要があります。最初にユーザーごとの MFA をテストすることにしました。Alex Wilber は、設定を検証することに同意しました。

### タスク1: MFAを有効にする前にサインインを検証する



1. パスワード **Pa55w.rd** を使用して **SEA-WS3** に**Admin **としてサインインします。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. サインイン ページで、「`AlexW@yourtenant.onmicrosoft.com`」と入力し、**Next** を選択します。

5. [**Enter password**] ページで、インストラクターから提供されたテナント パスワード(User Password)を入力し、[**Sign in]** を選択します。

6. [**Stay signed in?]** プロンプトで、[**No**] を選択します。

   > Outlook on the Web が開きます。Outlook on the Web にサインインするために必要なのはパスワードのみであることに注意してください。

7. Outlook on the Web 画面右上隅で、**Alex Wilber の写真のアイコン**をクリックし、**Sign out** を選択します。

8. Microsoft Edge を閉じます。

### タスク2: ユーザーのMFAの有効化



1. お手元のPCのブラウザーに切り替えます。アドレス バーに**[「https://entra.microsoft.com](https://entra.microsoft.com/)**」と入力して、**Enter キー**を押します。

2. ユーザー **`Admin@yourtenant.onmicrosoft.com`** としてサインインします。

   > Microsoft Entra 管理センターが開きます。

3. Web ページの上部にある [検索リソース] ボックスに「多要素認証」と入力し、 [**多要素認証**] を選択します。

   > 多要素認証ページが開きます。

4. **[クラウドベースの多要素認証の追加設定]**  のリンクを選択します。

5. [**ユーザーごとの多要素認証**] ページで、[**サービス設定**] を選択します。

6. [**サービス設定**] タブをクリックします。下

7. [**サービス設定**] 画面で下にスクロールして **[信頼済みデバイスでユーザーが多要素認証を記憶できるようにする]** のチェック ボックスをオンにします。

8. [**ユーザーがデバイスを信頼できる日数**] の横に「**30**」と入力し、[**保存]** を選択します。

9. 保存したら、[**サービス設定**] ページの上部までスクロールして、[**ユーザー]** タブを選択します。

10. ユーザーリストで、**Alex Wilber** の横にあるチェックボックスを選択します。

11. ユーザーリストの上で、[**MFA を有効にする]** を選択します。

12. [**多要素認証を有効にする]** メッセージで、[**有効にする]** を選択します。

13. 有効になったら、ページを更新します。Alex Wilber の **[ステータス**] が **[enabled]** になったことに注意してください。

### タスク3: MFAの登録と検証



1. **SEA-WS3** に切り替えます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. **Pick an account** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**Enter password**] ページで、テナントのパスワードを入力し、[**サインイン]** を選択します。

6. [**Let's keep your account secure**] ページで、[**Next**] を選択します。アカウントを安全に保つ ページが開きます。

   > 通常、Microsoft Authenticator アプリを使用して多要素認証を管理します。ただし、このラボ シナリオでは、テキスト メッセージを使用します。

7. [**Keep your account secure]** ページで、[**I want to set up a different method]** を選択します。[**Phone **] を選択して、使用可能な選択肢のリストを表示します。

8. Country Code に **Japan(+81)** を選択し、テキスト メッセージを受信できる携帯電話番号を入力し、[**Next**] を選択します。

9. 確認コードをテキスト メッセージとして受け取ったら、[**Keep your account secure]** ページに表示されるコードを入力し、[**Next**] を選択します。

10. [**Keep your account secure]** ページに、「確Verification complete. Your phone has been registered」と表示されます。[**Next**] を選択します。

11. [**Keep your account secure]** ページに、「Great job! You have successfully set up your security info」と表示されます。**[Done]** を選択します。

12. [サインインしたままにする] メッセージで、[**No**] を選択します。

    > Outlook on the Web が開き、Alex Wilber の受信トレイが表示されます。

13. **[Protect your account]** ダイアログが表示された場合は、[**Skip for now (x times left)] ** を選択します。

14. Outlook on the Web 画面右上隅で、**Alex Wilber の写真のアイコン**をクリックし、**Sign out** を選択します。

15. Microsoft Edge を閉じます。

### タスク4: ユーザーごとのMFAの削除



1. Microsoft Entra 管理センターの画面に切り替えます。

4. Microsoft Entra 管理センターのナビゲーション ウィンドウで、 **[ユーザー]** を選択します。

5. [**すべてのユーザー**] を選択し、結果ウィンドウの上部にある [**ユーザーごとの MFA**] を選択します。

   > [ユーザーごとの MFA] ページが開きます。

6. ユーザーリストで、**Alex Wilber** の横にあるチェックボックスを選択します。

7. ユーザーリストの上で、[**MFA の無効化]** を選択します。

8. [**多要素認証を無効にする]** メッセージで、[**無効にする]** を選択します。

7. [無効] になったら、ページを更新します。Alex Wilber の **[ステータス**] が **[disabled]** になったことに注意してください。

**結果**: この演習を完了すると、ユーザーごとの多要素認証が正常に構成されます。

## 演習 2: 条件付きアクセスを使用して多要素認証を構成する



### シナリオ



ユーザー サインオン イベントのセキュリティを強化するには、多要素認証 (MFA) を構成してテストする必要があります。条件付きアクセス ポリシーを使用すると、MFA 要件の柔軟性が向上すると判断しました。Alex Wilber は、設定を検証することに同意しました。

### タスク 1: MFA を使用して条件付きアクセスを有効にする前にサインインを検証する



1. **SEA-WS3** に切り替えます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. **Pick an account** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**Enter password**] ページで、インストラクターから提供されたテナント パスワード(User Password)を入力し、[**Sign in]** を選択します。

6. [**Stay signed in?]** プロンプトで、[**No**] を選択します。

   > Outlook が開き、Alex の受信トレイが表示されます。前の演習で MFA を削除したため、Outlook on the Web へのサインインに必要なのはパスワードのみであることに注意してください。

7. Outlook on the Web 画面右上隅で、**Alex Wilber の写真のアイコン**をクリックし、**Sign out** を選択します。

8. Microsoft Edge を閉じます。

### タスク 2: MFA を使用した条件付きアクセスの構成



1. Microsoft Entra 管理センターの画面に切り替えます。

2. ナビゲーション ウィンドウの **[Entra ID**] で、 **[条件付きアクセス]** を選択します。

3. [**条件付きアクセス]** ページで、[**ポリシー]** を選択し、 [**+ 新しいポリシー**] を選択します。

4. [**新しい条件付きアクセス ポリシー]** ページの [**名前**] ボックスに「**Contoso MFA ポリシー**」と入力します。

5. **[割り当て]** で、**0 個のユーザーとグループが選択されました**を選択します。

6. [ユーザーとグループ] ウィンドウで、[**ユーザーとグループの選択**] の横にあるオプションを選択します。

7. [**ユーザーとグループ**] の横にあるチェック ボックスをオンにします。

8. [**ユーザーとグループの選択**] ページで、 **[Alex Wilber**] の横にあるチェック ボックスをオンして、[**選択]** を選択します。

   > 通常はグループを指定しますが、この演習では Alex Wilber で設定をテストするだけです。

9. 「**ターゲット リソースが選択されていません」** リンクをクリックした後、右に表示される複数のラジオボタンから「**リソースの選択**」を選択します。

   > [クライアント アプリに基づいてアクセスを制御] 設定に注意してください。この設定を使用すると、リソースへのアクセスに使用するクライアント アプリを指定できます。たとえば、Outlook アプリのみを使用して Exchange Online にアクセスできるように指定できます。

10. ページの **[選択**] セクションで、[**なし**] をクリックします。

11. [**選択**] ページで、[**Office 365**] の横にあるチェック ボックスをオンにし、[**選択]** をクリックします。

12. [**アクセス制御]** の [**許可]** セクションで、**0 個のコントロールが選択されました**を選択します。

13. [**許可]** ページで、[**アクセスの許可**] を選択し、[**多要素認証が必要]** の横にあるチェック ボックスをオンにして、[**選択]** をクリックします。

14. **[ポリシーの有効化]** で、[**オン]** を選択します。

15. [**作成**] を選択して、Contoso MFA ポリシーを作成します。ポリシーが [**状態]** の [オン] で一覧表示されていることに注意してください。

    

### タスク 3: 条件付きアクセス MFA を検証する



1. **SEA-WS3** に切り替えます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. **Pick an account** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**Enter password**] ページで、インストラクターから提供されたテナント パスワード(User Password)を入力し、[**Sign in]** を選択します。

6. [Verify your identity] プロンプトで、電話番号を選択します。

   > 「**Enter code**」ダイアログ・ボックスが開きます。

7. **[Enter code**] ページで、携帯電話に送信されたコードを入力し、[**Verify]** を選択します。

8. **[Protect your account]** ダイアログが表示された場合は、[**Skip for now (x times left)] ** を選択します。

9. [**Stay signed in?]** プロンプトで、[**No**] を選択します。

   > Outlook on the Web が開き、Alex Wilber の受信トレイが表示されます。

10. Outlook on the Web 画面右上隅で、**Alex Wilber の写真のアイコン**をクリックし、**Sign out** を選択します。

11. Microsoft Edge を閉じます。

### タスク 4: 条件付きアクセス MFA を削除する



1. Microsoft Entra 管理センターの画面に切り替えます。
2. Microsoft Entra 管理センターのナビゲーション ウィンドウの **[Entra ID**] で、 **[条件付きアクセス]** を選択します。
3. [**条件付きアクセス]** ページで、 **[ポリシー]** を選択し、 [**Contoso MFA ポリシー]** を選択します。
4. **Contoso の [MFA ポリシー**] ページで、 **[削除]** を選択します。
5. [**よろしいですか?]** プロンプトで、[**はい**] を選択します。
8. Microsoft Edge を閉じます。

**結果**: この演習を完了すると、条件付きアクセス ポリシーを使用して多要素認証が正常に構成されます。

**ラボの終わり**
