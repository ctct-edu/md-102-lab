# ラボ 0501: 多要素認証の構成



## 概要



このラボでは、ユーザーごとの多要素認証 (MFA) を構成し、条件付きアクセス ポリシーを使用して MFA を適用します。

### 前提 条件



Entra ID への Windows Hello サインイン認証をセキュリティで保護するために使用されるテキスト メッセージを受信できる携帯電話が必要です。

## 演習 1: ユーザーごとの多要素認証を構成する



### シナリオ



ユーザー サインオン イベントのセキュリティを強化するには、多要素認証 (MFA) を構成してテストする必要があります。最初にユーザーごとの MFA をテストすることにしました。Alex Wilber は、設定を検証することに同意しました。

### タスク1: MFAを有効にする前にサインインを検証する



1. パスワード **Pa55w.rd** を使用して **SEA-WS3** に**管理者**としてサインインします。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. サインイン **ページで、「****`AlexW@yourtenant.onmicrosoft.com`**」と入力し、**次へ** を選択します。

5. [**パスワードの入力**] ページで、インストラクターから提供されたテナント パスワードを入力し、[**サインイン]** を選択します。[Edge のパスワードを保存(Save password)] プロンプトで、[**保存してオンにする(Save & Turn on**)] を選択します。

6. [**サインインしたままにする]** プロンプトで、[**いいえ**] を選択します。

   > Outlook on the Web が開きます。Outlook on the Web にサインインするために必要なのはパスワードのみであることに注意してください。

7. 右上隅で、**Alex Wilber のアカウント マネージャー**を選択し、**サインアウト** を選択します。

8. Microsoft Edge を閉じます。

### タスク2: ユーザーのMFAの有効化



1. **SEA-SVR1** に切り替えます。

2. **SEA-SVR1** では、必要に応じて、**Pa55w.rd** のパスワードを使用して **Contoso\Administrator** としてサインインし、**サーバー マネージャー**を閉じます。

3. タスク バーで **[Microsoft Edge]** を選択し、アドレス バーに**[「https://entra.microsoft.com](https://entra.microsoft.com/)**」と入力して、**Enter キー**を押します。

4. ユーザー **`Admin@yourtenant.onmicrosoft.com`** としてサインインし、テナント管理者パスワードを使用します。[**サインインしたままにする?]** プロンプトが表示されたら、[**いいえ**] を選択します。

   > Microsoft Entra 管理センターが開きます。

5. Web ページの上部にある [検索リソース] ボックスに「多要素認証」と入力し、 [**多要素認証**] を選択します。

   > 多要素認証ページが開きます。

6. **[追加のクラウドベースの多要素認証設定]** を選択します。

7. [**ユーザーごとの多要素認証**] ページで、[**サービス設定**] を選択します。

8. [**サービス設定**] ページで、下にスクロールして **[ユーザーが信頼するデバイスで多要素認証を記憶できるようにする]** のチェック ボックスをオンにします。

9. [**ユーザーがデバイスを信頼できる日数**] の横に「**30**」と入力し、[**保存]** を選択します。

10. 保存したら、[**サービス設定**] ページの上部までスクロールして、[**ユーザー]** を選択します。

11. ユーザーリストで、**Alex Wilber** の横にあるチェックボックスを選択します。

12. ユーザーリストの上で、[**MFA を有効にする]** を選択します。

13. [**多要素認証を有効にする]** メッセージで、[**有効]** を選択します。

14. 有効になったら、ページを更新します。Alex Wilber の **[ステータス**] が **[有効]** になったことに注意してください。

15. Microsoft Edge を閉じます。

### タスク3: MFAの登録と検証



1. **SEA-WS3** に切り替えます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. **アカウントの選択** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**パスワードの入力**] ページで、テナントのパスワードを入力し、[**サインイン]** を選択します。

6. [**アカウントをセキュリティで保護しましょう**] ページで、[**次へ**] を選択します。アカウントを安全に保つ ページが開きます。

   > 通常、Microsoft Authenticator アプリを使用して多要素認証を管理します。ただし、このラボ シナリオでは、テキスト メッセージを使用します。

7. [**アカウントをセキュリティで保護する]** ページで、[**別の方法を設定する]** を選択します。[**電話**] を選択して、使用可能な選択肢のリストを表示します。

8. テキスト メッセージを受信できる携帯電話番号を入力し、[**次へ**] を選択します。

9. 確認コードをテキスト メッセージとして受け取ったら、[**アカウントをセキュリティで保護する]** ページに表示されるコードを入力し、[**次へ**] を選択します。

10. [**アカウントを安全に保つ]** ページに、「確認が完了しました。あなたの携帯電話は登録されました」と述べています。[**次へ**] を選択します。

11. [**アカウントを安全に保つ]** ページに、「よくやった!セキュリティ情報を正常に設定しました」と入力します。**[完了]** を選択します。

12. [サインインしたままにする] メッセージで、[**いいえ**] を選択します。

    > Outlook on the Web が開き、Alex Wilber の受信トレイが表示されます。

13. **[アカウントの保護]** ダイアログが表示された場合は、[**今のところスキップ] を選択します (残り \*x\* 回)。**

14. 右上隅で、**Alex Wilber のアカウント マネージャー**を選択し、**サインアウト** を選択します。

15. Microsoft Edge を閉じます。

### タスク4: ユーザーごとのMFAの削除



1. **SEA-SVR1** に切り替えます。

2. **SEA-SVR1** では、タスク バーで **[Microsoft Edge]** を選択し、アドレス バーに**[「https://entra.microsoft.com](https://entra.microsoft.com/)**」と入力して、**Enter キー**を押します。

3. **`Admin@yourtenant.onmicrosoft.com`** としてサインインし、テナント管理者パスワードを使用します。**[サインインしたままにする?]** プロンプトが表示されたら、[**いいえ**] を選択します。

   > Microsoft Entra 管理センターが開きます。

4. Microsoft Entra 管理センターのナビゲーション ウィンドウで、 **[ユーザー]** を選択します。

5. [**すべてのユーザー**] を選択し、結果ウィンドウの上部にある [**ユーザーごとの MFA**] を選択します。

   > [ユーザーごとの MFA] ページが開きます。

6. ユーザーリストで、**Alex Wilber** の横にあるチェックボックスを選択します。

7. ユーザーリストの上で、[**MFA の無効化]** を選択します。

8. [**多要素認証を無効にする]** メッセージで、[**無効にする]** を選択します。

9. [無効] になったら、ページを更新します。Alex Wilber の **[ステータス**] が **[無効]** になったことに注意してください。

10. Microsoft Edge を閉じます。

**結果**: この演習を完了すると、ユーザーごとの多要素認証が正常に構成されます。

## 演習 2: 条件付きアクセスを使用して多要素認証を構成する



### シナリオ



ユーザー サインオン イベントのセキュリティを強化するには、多要素認証 (MFA) を構成してテストする必要があります。条件付きアクセス ポリシーを使用すると、MFA 要件の柔軟性が向上すると判断しました。Alex Wilber は、設定を検証することに同意しました。

### タスク 1: MFA を使用して条件付きアクセスを有効にする前にサインインを検証する



1. パスワード **Pa55w.rd** を使用して **SEA-WS3** に**管理者**としてサインインします。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**outlook.office.com**」と入力し、Enter キーを押します。

4. **アカウントの選択** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**パスワードの入力**] ページで、テナントのパスワードを入力し、[**サインイン]** を選択します。

6. サインイン**したままにする** ページで、**いいえ** を選択します。

   > Outlook が開き、Alex の受信トレイが表示されます。前の演習で MFA を削除したため、Outlook on the Web へのサインインに必要なのはパスワードのみであることに注意してください。

7. 右上隅で、**Alex Wilber のアカウント マネージャー**を選択し、**サインアウト** を選択します。

8. Microsoft Edge を閉じます。

### タスク 2: MFA を使用した条件付きアクセスの構成



1. **SEA-SVR1** に切り替えます。

2. **SEA-SVR1** では、タスク バーで **[Microsoft Edge]** を選択し、アドレス バーに**[「https://entra.microsoft.com](https://entra.microsoft.com/)**」と入力して、**Enter キー**を押します。

3. **`Admin@yourtenant.onmicrosoft.com`** としてサインインし、テナント管理者パスワードを使用します。**[サインインしたままにする?]** プロンプトが表示されたら、[**いいえ**] を選択します。

   > Microsoft Entra 管理センターが開きます。

4. ナビゲーション ウィンドウの **[Entra ID**] で、 **[条件付きアクセス]** を選択します。

5. [**条件付きアクセス]** ページで、[**ポリシー]** を選択し、 [**+ 新しいポリシー**] を選択します。

6. [**新しい条件付きアクセス ポリシー]** ページの [**名前**] ボックスに「**Contoso MFA ポリシー**」と入力します。

7. **[割り当て]** で、**選択した 0 のユーザーとグループ**を選択します。

8. [ユーザーとグループ] ウィンドウで、[**ユーザーとグループの選択**] の横にあるオプションを選択し、[**ユーザーとグループ**] の横にあるチェック ボックスをオンにします。

9. [**ユーザーとグループの選択**] ページで、 **[Alex Wilber**] を選択し、[**選択]** を選択します。

   > 通常はグループを指定しますが、この演習では Alex Wilber で設定をテストするだけです。

10. 「**ターゲット・リソースが選択されていない」**を選択し、「**リソースの選択**」をクリックします。

    > [クライアント アプリに基づいてアクセスを制御] 設定に注意してください。この設定を使用すると、リソースへのアクセスに使用するクライアント アプリを指定できます。たとえば、Outlook アプリのみを使用して Exchange Online にアクセスできるように指定できます。

11. ページの **[選択**] セクションで、[**なし**] をクリックします。

12. [**選択**] ページで、[**Office 365**] の横にあるチェック ボックスをオンにし、[**選択]** をクリックします。

13. [**アクセス制御]** の [**許可]** セクションで、**選択した 0 個のコントロール**を選択します。

14. [**許可]** ページで、[**アクセスの許可**] を選択し、[**多要素認証が必要]** の横にあるチェック ボックスをオンにして、[**選択]** をクリックします。

15. **[ポリシーを有効にする]** で、[**オン]** を選択します。

16. [**作成**] を選択して、Contoso MFA ポリシーを作成します。ポリシーが [**状態]** の [オン] で一覧表示されていることに注意してください。

17. Microsoft Edge を閉じます。

### タスク 3: 条件付きアクセス MFA を検証する



1. **SEA-WS3** に切り替えます。

2. タスク バーで、[**Microsoft Edge]** を選択します。

3. アドレスバーに「**[https://outlook.office.com](https://outlook.office.com/)**」と入力し、Enter キーを押します。

4. **アカウントの選択** ページで、**`AlexW@yourtenant.onmicrosoft.com`** を選択します。

5. [**パスワードの入力**] ページで、テナントのパスワードを入力し、[**サインイン]** を選択します。

6. [本人確認] プロンプトで、電話番号を選択します。

   > 「コードを入力」ダイアログ・ボックスが開きます。

7. **[コードの入力**] ページで、携帯電話に送信されたコードを入力し、[**確認]** を選択します。

8. **[アカウントの保護]** ダイアログが表示された場合は、[**今のところスキップ] を選択します (残り \*x\* 回)。**

9. [サインインしたままにする] メッセージで、[**いいえ**] を選択します。

   > Outlook on the Web が開き、Alex Wilber の受信トレイが表示されます。

10. 右上隅で、**Alex Wilber のアカウント マネージャー**を選択し、**サインアウト** を選択します。

11. Microsoft Edge を閉じます。

### タスク 4: 条件付きアクセス MFA を削除する



1. **SEA-SVR1** に切り替えます。

2. **SEA-SVR1** では、タスク バーで **[Microsoft Edge]** を選択し、アドレス バーに**[「https://entra.microsoft.com](https://entra.microsoft.com/)**」と入力して、**Enter キー**を押します。

3. ユーザー **`Admin@yourtenant.onmicrosoft.com`** としてサインインし、テナント管理者パスワードを使用します。[**サインインしたままにする?]** プロンプトが表示されたら、[**いいえ**] を選択します。

   > Microsoft Entra 管理センターが開きます。

4. Microsoft Entra 管理センターのナビゲーション ウィンドウの **[Entra ID**] で、 **[条件付きアクセス]** を選択します。

5. [**条件付きアクセス]** ページで、 **[ポリシー]** を選択し、 [**Contoso MFA ポリシー]** を選択します。

6. **Contoso の [MFA ポリシー**] ページで、 **[削除]** を選択します。

7. [**よろしいですか?]** プロンプトで、[**はい**] を選択します。

8. Microsoft Edge を閉じます。

**結果**: この演習を完了すると、条件付きアクセス ポリシーを使用して多要素認証が正常に構成されます。

**ラボの終わり**
