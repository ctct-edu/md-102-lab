# ラボ 0701: Microsoft Deployment Toolkit を使用した Windows 11 の展開



## 概要



このラボでは、Microsoft Deployment Toolkit を使用して、Windows 11 オペレーティング システム イメージを作成および展開します。

### シナリオ



SEA-WS4 という名前の新しい Windows 11 仮想マシンを展開する必要があります。Microsoft Deployment Toolkit を使用して、Hyper-V で作成された仮想マシンにオペレーティング システムを展開することにしました。MDT で新しい展開共有を構成し、SEA-WS4 を展開する手順を実行するタスク シーケンスを構成します。

### タスク1: 新しいデプロイメント共有の作成



1. **SEA-SVR2** で、パスワード **Pa55w.rd** を使用して **Contoso\Administrator** としてサインインします。

2. タスク バーで **[エクスプローラー]** を選択し、**E:\Labfiles\ISO** を参照します。

3. **Win11_21H2_Eval.iso**を右クリックし、[**マウント]** を選択します。ISO は DVD ドライブ F としてマウントされます。

4. **エクスプローラーを**閉じます。

5. **[スタート]** を選択し、[**Microsoft Deployment Toolkit]** を展開して、[**Deployment Workbench**] を選択します。

6. **Deployment Workbench**で、[**Deployment Shares**]を右クリックし、[**New Deployment Share**]を選択します。

   > **[新しい展開共有ウィザード**] が開きます。

7. [**パス]** ページの **[デプロイ共有パス]** で、値を **[E:\DeploymentShare**] に変更し、[**次へ**] を選択します。

8. [**共有]** ページで、**共有名**をメモしますが、変更しないでください。[**次へ**] を選択します。

9. [**説明名**] ページで、既定値を受け入れて [**次へ**] を選択します。

10. [**オプション]** ページで、以下を構成し、[**次へ**] を選択します。

    - ローカル管理者パスワードの設定を依頼する: **有効**
    - その他のすべてのチェックボックス: **無効**

11. [**概要]** ページで、情報を確認し、[**次へ**] を選択します。

12. 確認 **ページで、**プロセスが正常に完了したことを確認し、**完了** を選択します。

13. [**展開共有**] で、[**MDT 展開共有**] フォルダーを展開します。

    > デプロイ共有用に構成できるさまざまなノードをメモします。

### タスク2: オペレーティング・システム・ファイルをデプロイメント共有に追加する



1. Deployment Workbench で、[**Deployment Shares**]、[**MDT Deployment Share**] の順に展開し、[**オペレーティング システム]** を選択します。

2. **[オペレーティングシステム]**を右クリックし、[**オペレーティングシステムのインポート]**を選択します。オペレーティングシステムのインポートウィザードが開きます。

3. **オペレーティング システムのインポート ウィザード**の [**OS の種類**] ページで、[**ソース ファイルのフル セット**] を選択し、[**次へ**] を選択します。

4. [**ソース**] ページの **[ソース ディレクトリ**] に「**F:\**」と入力し、[**次へ**] を選択します。

5. [**宛先]** ページで、既定の宛先ディレクトリ名を **Windows 11 Enterprise x64** に変更し、[**次へ**] を選択します。

6. [**概要]** ページで、情報を確認し、[**次へ**] を選択します。

   > オペレーティング システムのソース ファイルが展開共有にコピーされます。

7. 確認 **ページで、**プロセスが正常に完了したことを確認し、**完了** を選択します。

8. デプロイ**メントワークベンチ**で、「**オペレーティングシステム」**を選択した状態で、オペレーティングシステムが表示されることを確認します。

### タスク3: デプロイメント共有へのアプリケーションの追加



1. Deployment Workbench で、[**Deployment Shares**]、[**MDT Deployment Share**] の順に展開し、[**アプリケーション]** を選択します。
2. **[アプリケーション]** を右クリックし、[**新しいアプリケーション]** を選択します。[新規アプリケーションウィザード] が開きます。
3. **新しいアプリケーション ウィザード**の [**アプリケーションの種類**] ページで、[**ソース ファイルを含むアプリケーション**] を選択し、[**次へ**] を選択します。
4. [**詳細]** ページで、以下を構成し、[**次へ**] を選択します。
   - パブリッシャー: **マイクロソフト**
   - アプリケーション名: **XML メモ帳**
5. [**ソース**] ページの [**ソース ディレクトリ**] に「**E:\Labfiles\Apps**」と入力し、[**次へ**] を選択します。
6. [**宛先]** ページで、既定の宛先ディレクトリ名を受け入れ、[**次へ**] を選択します。
7. [**コマンドの詳細]** ページの **[コマンド ライン]** に「**/q」XmlNotepadSetup.msi**入力し、[**次へ**] を選択します。
8. [**概要]** ページで、情報を確認し、[**次へ**] を選択します。
9. 確認 **ページで、**プロセスが正常に完了したことを確認し、**完了** を選択します。

### タスク 4: MDT タスク シーケンスの作成



1. Deployment Workbench で、[**Deployment Shares**]、[**MDT Deployment Share**] の順に展開し、[**タスク シーケンス]** を選択します。

2. [**タスク シーケンス]** を右クリックし、[**新しいタスク シーケンス**] を選択します。**新しいタスク シーケンス ウィザード**が開きます。

3. [**一般設定**] ページで、以下を構成し、[**次へ**] を選択します。

   - タスク シーケンス ID: **001**
   - タスク シーケンス名: **Windows 11 Enterprise を展開する**

4. [**テンプレートの選択]** ページで、[**標準クライアント タスク シーケンス**] を選択し、[**次へ**] を選択します。

5. [**OS の選択**] ページで、[**Windows 10 Enterprise 評価]** を選択し、[**次へ**] を選択します。

6. **[プロダクト キーの指定]** ページで、[**この時点ではプロダクト キーを指定しない]** を選択し、[**次へ**] を選択します。

7. [**OS 設定**] ページで、以下を構成し、[**次へ**] を選択します。

   - フルネーム: **ユーザー**
   - 組織: **Contoso Corporation**
   - Internet Explorer のホーム ページ: **about:blank**

8. [**管理者パスワード**] ページで、[**指定したローカル管理者パスワードを使用する**] を選択し、両方のテキスト ボックスに**「Pa55w.rd**」と入力します。[**次へ**] を選択します。

9. [**概要]** ページで、情報を確認し、[**次へ**] を選択します。

10. 確認 **ページで、**プロセスが正常に完了したことを確認し、**完了** を選択します。

11. 展開**ワークベンチ**で、[**タスク シーケンス]** を選択した状態で、[**Windows 11 Enterprise の展開**] タスク シーケンスが表示されていることを確認します。

12. [**Windows 11 Enterprise の展開]** タスク シーケンスを右クリックし、[**プロパティ]** を選択します。

13. [**タスク シーケンス**] タブを選択します。

14. [**検証]** ノードを展開し、[**検証]** を選択します。

15. [**プロパティ]** ページで、[**最小メモリの確保]** と **[プロセッサの最小速度の確保]** の横にあるチェック マークを外します。

    > その他の変更は行わないでください。

16. [**Windows 11 Enterprise のプロパティの展開]** ウィンドウで、[**OK]** を選択します。

### タスク 5: 展開共有のプロパティと Windows PE 設定の構成



1. デプロイメント・ワークベンチで、「**デプロイメント共有」**を展開し、「**MDT デプロイメント共有**」を選択します。

2. [**MDT 展開共有**] を右クリックし、[**プロパティ]** を選択します。

3. **[MDT 展開共有のプロパティ]** ウィンドウの [**全般**] タブで、展開共有の作成時に提供された情報をメモします。

4. [**ルール]** タブを選択します。

   > [ルール] タブには、CustomSettings.ini ファイルの内容が表示されます。これらの値は、デプロイ共有の作成時にも提供されました。

5. [**Windows PE**] タブを選択します。

   > [Windows PE] タブには、Windows PE ブート ディスクを作成するためのオプションが用意されています。

6. [**Windows PE**] タブの **[プラットフォーム]** の横にある [**x64**] を選択します。

7. [**Windows PE のカスタマイズ]** セクションの **[スクラッチ領域サイズ**] の横にある [**64**] を選択します。

8. [**機能**] タブを選択し、次の機能パックの横にあるチェック ボックスをオンにします。

   - DISM コマンドレット
   - Windows PowerShell
   - Microsoft データ アクセス コンポーネント (MDAC/ADO) のサポート

9. [**監視]** タブを選択します。

10. [**監視]** タブで、[**この展開共有の監視を有効にする]** の横にあるチェック ボックスをオンにします。

11. [**MDT 展開共有のプロパティ]** ウィンドウで、[**OK]** を選択します。

12. [**MDT 展開共有**] を右クリックし、[**展開共有の更新**] を選択します。展開共有の更新ウィザードが開きます。

13. [**オプション]** ページで、[**ブート イメージの更新プロセスの最適化**] を選択し、[**次へ**] を選択します。

14. **概要** ページで、**次へ** を選択します。

    > 展開共有は、Windows PE ファイルの更新と作成を開始します。完了するまでに数分かかります。

15. 確認 **ページで、**プロセスが正常に完了したことを確認し、**完了** を選択します。

### タスク 6: MDT を使用した Windows 11 の展開



1. SEA-SVR2 のタスク バーで、[**Hyper-V マネージャー**] を選択します。

2. Hyper-V マネージャーで、[**仮想スイッチ マネージャー]** を選択します。

3. [**新しい仮想ネットワーク スイッチ**] を選択し、詳細ウィンドウで **[外部]** を選択します。[**仮想スイッチの作成]** を選択します。

4. [**仮想スイッチのプロパティ] ページの [****名前**] に「**外部ネットワーク」**と入力し、[**OK]** を選択して、[**はい**] を選択します。

5. Hyper-V マネージャーで **[SEA-SVR2**] を選択し、[アクション] ウィンドウで [**新規**] を選択し、[**仮想マシン]** を選択します。

6. [**開始する前に**] ページで、[**次へ**] を選択します。

7. [**名前と場所の指定**] ページの [**名前**] ボックスに「**SEA-WS4」**と入力します。

8. [**仮想マシンを別の場所に保存する]** の横にあるチェック ボックスをオンにし、[**場所]** の横に「**E:\Labfiles\VirtualMachines**」と入力します。[**次へ**] を選択します。

9. [**世代の指定**] ページで、[**世代 2]** が選択されていることを確認し、[**次へ**] を選択します。

10. [**メモリの割り当て]** ページの **[スタートアップ メモリ]** の横に「**8192**」と入力し、[**次へ**] を選択します。

11. [**ネットワークの構成]** ページの **[接続]** の横にある **[外部ネットワーク]** を選択し、 [**次へ**] を選択します。

12. [**仮想ハード ディスクの接続**] ページで、[**仮想ハード ディスクの作成**] を選択し、次のように入力して [**次へ**] をクリックします。

    - 名前: **SEA-WS4.vhdx**
    - 場所: **E:\Labfiles\VirtualMachines**
    - サイズ: **60 GB**

13. [**インストール オプション]** ページで、[**ブータブル イメージ ファイルからオペレーティング システムをインストールする]** を選択し、以下を設定します。

    - イメージ ファイル (.iso): **E:\DeploymentShare\Boot\LiteTouchPE_x64.iso**

14. [**次へ**] を選択し、[**完了]** を選択します。

15. Hyper-V マネージャーで、[**SEA-WS4**] を右クリックし、[**設定]** を選択します。

16. [**セキュリティ]** を選択し、[**トラステッド プラットフォーム モジュールを有効にする]** の横にあるチェック ボックスをオンにします。

17. **[プロセッサ]** を選択し、仮想プロセッサの数を **2** に変更します。

18. [**OK**] を選択して [設定] ダイアログ ボックスを閉じます。

19. Hyper-V マネージャーで、[**SEA-WS4**]、[**接続]**、[**開始]** の順に選択します。

20. コンピュータが起動したら、キーボードの任意のキーを押して、MDT 展開ウィザードを呼び出します。必要に応じてウィンドウを最大化します。

21. [**ようこそ**] ページで、[**展開ウィザードの実行] を選択して、新しいオペレーティング システムをインストールします**。

22. [**ネットワーク共有に接続するための資格情報の指定**] ウィンドウで、次のように入力し、[**OK]** を選択します。

    - ユーザー名: **管理者**
    - パスワード:**Pa55w.rd**
    - ドメイン: **Contoso**

23. [**タスク シーケンス]** ページで、[**Windows 11 Enterprise の展開]** を選択し、[**次へ**] を選択します。

24. [**コンピューターの詳細**] ページの **[コンピューター名**] の横に「**SEA-WS4**」と入力し、[**次へ**] を選択します。

25. **[データと設定の移動]** ページで、[**次へ**] を選択します。

26. [**ユーザー データ (復元)]** ページで、[**次へ**] を選択します。

27. [**ロケールと時刻]** ページで、[**次へ**] を選択します。

28. [**アプリケーション]** ページで、[**次へ**] を選択します。

29. [**管理者パスワード]** ページで、両方のテキスト ボックスに「**Pa55w.rd**」と入力し、[**次へ**] を選択します。

30. 準備**完了** ページで、**開始** を選択します。

    > インストールが開始されます。完了するまでに 15 分から 20 分かかり、必要に応じてインストール中に SEA-WS4 が再起動されます。

31. **デプロイメントワークベンチ**に切り替えます。

32. Deployment Workbench で、[**Deployment Shares**] を展開し、[**MDT Deployment Share**] を展開します。

33. **[モニタリング]** を選択し、詳細ペインで **[SEA-WS4**] をダブルクリックします。

    > デプロイ中に監視ステータスを確認します。

34. **SEA-WS4** に切り替えます。

35. インストールが完了すると、デスクトップが開き、展開が完了します。デプロイの概要で、 **[完了]** を選択します。

36. **SEA-WS4** をシャットダウンし、[仮想マシン接続] ウィンドウを閉じます。

37. Hyper-V マネージャーで、[**SEA-WS4**] を右クリックし、[**設定]** を選択します。

38. **[SEA-WS4 の設定**] で、[**SCSI コントローラ]** を展開し、[**DVD ドライブ**] を選択します。

39. 詳細ウィンドウの **[メディア**] で [**なし**] を選択し、[**OK]** を選択します。

40. **[SEA-WS4**]を右クリックし、[**チェックポイント]**を選択して、SEA-WS4の現在の状態のチェックポイントを作成します。

41. SEA-SVR2 では、**Hyper-V マネージャー**を閉じ、**Deployment Workbench** を閉じます。

42. **ファイルエクスプローラー**を開き、**DVDドライブF**を右クリックして、[**取り出し**]を選択します。

43. **エクスプローラを**閉じて、**SEA-SVR2** からサインアウトします。

**結果**: この演習を完了すると、Microsoft Deployment Toolkit を使用して Windows 11 ワークステーションを作成および展開できます。

**ラボの終わり**
